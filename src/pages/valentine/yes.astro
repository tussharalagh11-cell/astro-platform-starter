---
const memories = [
  { src: "/images/3.jpg",  type: "image", caption: "The day everything felt lighter.", date: "Together" },
  { src: "/images/4.jpg",  type: "image", caption: "That laugh I wish I could replay.", date: "Fun" },
  { src: "/images/5.jpg",  type: "image", caption: "Soft smiles, louder heartbeats.", date: "Smiles" },
  { src: "/images/6.jpg",  type: "image", caption: "Little moments that became big memories.", date: "Laughs" },
  { src: "/images/7.jpg",  type: "image", caption: "You + me + a little adventure.", date: "Adventure" },
  { src: "/images/8.jpg",  type: "image", caption: "Wherever we go, it feels like home.", date: "Travel" },
  { src: "/images/9.jpg",  type: "image", caption: "Quiet joy. The kind that stays.", date: "Joy" },
  { src: "/images/10.jpg", type: "image", caption: "The sweetest kind of closeness.", date: "Love" },
  { src: "/images/11.jpg", type: "image", caption: "A simple day, made unforgettable.", date: "Days" },
  { src: "/images/15.jpg", type: "image", caption: "A memory I keep smiling at.", date: "Special" },
  { src: "/images/16.jpg", type: "image", caption: "Just you ‚Äî and that calm I like.", date: "Always" },
  { src: "/images/20.mp4", type: "video", caption: "A little replay of us. üíñ", date: "Replay" },
];

// Shown in the timeline tile for the video (NOT the actual video)
const videoThumb = "/images/16.jpg";

const backLink = "/valentine";
---

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Yes üíñ</title>
    <meta name="theme-color" content="#0a0217" />

    <style>
      :root{
        --bg1:#2b0b3f; --bg2:#0a0217; --bg3:#04010a;
        --text:#fdf7ff;
        --muted:rgba(255,255,255,.78);
        --card:rgba(16,5,32,.72);
        --stroke:rgba(255,255,255,.12);
        --shadow:rgba(8,2,18,.55);
        --pink1:#ff7ac8; --pink2:#f73c72; --blue2:#548bff;
        --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono","Courier New", monospace;
        --sans: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
      }

      *{box-sizing:border-box}
      html,body{height:100%}
      body{
        margin:0;
        color:var(--text);
        font-family:var(--sans);
        overflow-x:hidden;
        background:
          radial-gradient(900px 520px at 50% -10%, rgba(255,122,200,0.22), transparent 55%),
          radial-gradient(800px 540px at 0% 30%, rgba(84,139,255,0.16), transparent 55%),
          radial-gradient(circle at top, var(--bg1) 0%, var(--bg2) 55%, var(--bg3) 100%);
      }

      /* floating hearts */
      .hearts{
        position:fixed; inset:0;
        pointer-events:none;
        z-index:1;
        opacity:.95;
      }
      .hearts span{
        position:absolute;
        left:var(--x); top:var(--y);
        font-size:var(--s);
        color:rgba(255,122,200,.22);
        animation:drift var(--d) ease-in-out infinite;
        filter:blur(.2px);
      }
      @keyframes drift{
        0%,100%{transform:translateY(0) translateX(0) scale(1);opacity:.25}
        50%{transform:translateY(-18px) translateX(10px) scale(1.08);opacity:.85}
      }

      .wrap{
        min-height:100vh;
        display:grid;
        place-items:center;
        padding:34px 18px;
        position:relative;
        z-index:2;
      }

      .card{
        width:min(980px,100%);
        border-radius:28px;
        background:
          linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.02)),
          var(--card);
        border:1px solid var(--stroke);
        box-shadow:0 30px 90px var(--shadow);
        overflow:hidden;
        backdrop-filter: blur(10px);
        -webkit-backdrop-filter: blur(10px);
      }

      .hero{
        padding:clamp(18px,3.2vw,30px);
        text-align:center;
      }

      .pill{
        display:inline-flex;
        align-items:center;
        gap:10px;
        padding:10px 14px;
        border-radius:999px;
        background:rgba(255,255,255,.08);
        border:1px solid rgba(255,255,255,.12);
        color:rgba(255,255,255,.86);
        font-size:.95rem;
        letter-spacing:.01em;
      }
      .pill .dot{
        width:8px;height:8px;border-radius:50%;
        background:linear-gradient(135deg,var(--pink1),var(--blue2));
        box-shadow:0 0 12px rgba(255,122,200,.45);
      }

      h1{
        margin:14px 0 8px;
        font-size:clamp(2.05rem,3.9vw,2.85rem);
        line-height:1.12;
        letter-spacing:-.02em;
        font-weight:950;
      }
      .sub{
        margin:0 auto 16px;
        max-width:64ch;
        color:var(--muted);
        line-height:1.7;
        font-size:1.03rem;
      }

      .actions{
        display:flex;
        gap:12px;
        justify-content:center;
        flex-wrap:wrap;
        margin-top:10px;
      }
      .btn{
        text-decoration:none;
        padding:12px 18px;
        border-radius:999px;
        font-weight:900;
        border:1px solid rgba(255,255,255,.16);
        transition:transform .18s ease, box-shadow .18s ease, filter .18s ease;
        user-select:none;
        display:inline-flex;
        align-items:center;
        gap:10px;
        cursor:pointer;
        background:rgba(255,255,255,.06);
        color:rgba(255,255,255,.92);
      }
      .btn:hover{transform:translateY(-2px);box-shadow:0 16px 30px rgba(247,146,255,.16)}
      .btn:active{transform:translateY(0) scale(.99)}
      .btn-primary{
        background:linear-gradient(135deg,var(--pink1),var(--pink2));
        color:#16010f;
        border-color:rgba(255,122,200,.35);
      }

      .divider{height:1px;background:rgba(255,255,255,.08)}

      /* timeline */
      .timeline{padding:clamp(16px,3vw,26px)}
      .timeline-head{
        display:flex;
        align-items:baseline;
        justify-content:space-between;
        gap:12px;
        margin-bottom:14px;
        flex-wrap:wrap;
      }
      .timeline h2{margin:0;font-size:1.15rem;letter-spacing:.01em}
      .hint{
        margin:0;
        color:rgba(255,255,255,.62);
        font-size:.92rem;
      }

      .story{
        position:relative;
        padding-left:22px;
        display:grid;
        gap:14px;
      }
      .story::before{
        content:"";
        position:absolute;
        left:10px; top:4px; bottom:4px;
        width:2px;
        background:linear-gradient(180deg, rgba(255,122,200,.65), rgba(84,139,255,.18));
        opacity:.6;
      }
      .event{position:relative}
      .pin{
        position:absolute;
        left:-2px;
        top:18px;
        width:18px;height:18px;border-radius:50%;
        background:linear-gradient(135deg, rgba(255,122,200,.95), rgba(84,139,255,.85));
        box-shadow:0 0 0 4px rgba(255,255,255,.06), 0 16px 30px rgba(255,122,200,.18);
      }

      .tile{
        position:relative;
        border-radius:20px;
        overflow:hidden;
        border:1px solid rgba(255,255,255,.12);
        background:rgba(0,0,0,.16);
        cursor:pointer;
        aspect-ratio:16/9;
        transition:transform .25s ease, box-shadow .25s ease;
        padding:0;
        width:100%;
        text-align:left;
      }
      .tile:hover{transform:translateY(-2px);box-shadow:0 18px 50px rgba(0,0,0,.25)}

      .tile img{
        width:100%;height:100%;
        display:block;
        object-fit:cover;
        transform:scale(1.02);
        transition:transform .35s ease, filter .35s ease;
        filter:saturate(1.08);
      }
      .tile:hover img{transform:scale(1.08);filter:saturate(1.18)}

      .video-badge{
        position:absolute;
        top:12px; right:12px;
        font-size:.82rem;
        padding:8px 10px;
        border-radius:999px;
        background:rgba(0,0,0,.45);
        border:1px solid rgba(255,255,255,.16);
        color:rgba(255,255,255,.9);
        backdrop-filter: blur(8px);
      }

      .cap{
        position:absolute;
        inset:auto 0 0 0;
        padding:12px 12px 12px;
        background:linear-gradient(180deg, transparent, rgba(0,0,0,.72));
        color:rgba(255,255,255,.94);
      }
      .cap .date{
        font-size:.84rem;
        opacity:.9;
        letter-spacing:.02em;
      }
      .cap .text{
        margin-top:4px;
        font-size:1.02rem;
        line-height:1.35;
        font-weight:900;
      }

      /* Lightbox */
      .lightbox{
        position:fixed;
        inset:0;
        display:none;
        place-items:center;
        background:rgba(0,0,0,.80);
        z-index:99999;
        padding:18px;
      }
      .lightbox.open{display:grid}

      .lb-inner{
        width:min(1020px,100%);
        background:rgba(16,5,32,.80);
        border:1px solid rgba(255,255,255,.14);
        border-radius:22px;
        overflow:hidden;
        box-shadow:0 30px 90px rgba(0,0,0,.55);
        transform:scale(.985);
        opacity:0;
        animation:cinIn 240ms ease forwards;
      }
      @keyframes cinIn{to{transform:scale(1);opacity:1}}

      .lb-bar{
        display:flex;
        align-items:center;
        justify-content:space-between;
        gap:10px;
        padding:12px 14px;
        background:rgba(255,255,255,.04);
        border-bottom:1px solid rgba(255,255,255,.08);
        color:rgba(255,255,255,.78);
        font-size:.9rem;
      }
      .lb-title{
        font-weight:800;
        letter-spacing:.01em;
      }
      .lb-controls{display:inline-flex;gap:8px;align-items:center}
      .iconbtn{
        background:rgba(255,255,255,.06);
        color:rgba(255,255,255,.9);
        border:1px solid rgba(255,255,255,.14);
        border-radius:999px;
        padding:8px 12px;
        cursor:pointer;
        user-select:none;
        transition:transform .15s ease, filter .15s ease;
      }
      .iconbtn:hover{transform:translateY(-1px);filter:brightness(1.08)}
      .iconbtn:active{transform:translateY(0) scale(.99)}

      .lb-stage{
        position:relative;
        background:rgba(0,0,0,.35);
        display:grid;
        place-items:center;
        min-height:55vh;
      }

      .lb-media{
        width:100%;
        display:grid;
        place-items:center;
      }

      .lb-media img,
      .lb-media video{
        width:100%;
        max-height:76vh;
        object-fit:contain;
        background:rgba(0,0,0,.22);
      }

      .lb-caption{
        position:absolute;
        left:0; right:0; bottom:0;
        padding:14px 14px 16px;
        background:linear-gradient(180deg, transparent, rgba(0,0,0,.82));
        color:rgba(255,255,255,.94);
        text-align:left;
        pointer-events:none;
      }
      .lb-caption .date{font-size:.86rem;opacity:.86}
      .lb-caption .text{margin-top:4px;font-size:1.05rem;line-height:1.35;font-weight:950}

      .lb-hint{
        padding:10px 14px 14px;
        color:rgba(255,255,255,.62);
        font-size:.85rem;
        border-top:1px solid rgba(255,255,255,.08);
        background:rgba(255,255,255,.02);
      }

      @media (prefers-reduced-motion: reduce){
        *{animation:none!important;transition:none!important}
      }
    </style>
  </head>

  <body>
    <div class="hearts" aria-hidden="true" id="hearts"></div>

    <main class="wrap">
      <section class="card" aria-label="Yes page with timeline gallery">
        <div class="hero">
          <div class="pill"><span class="dot"></span> I‚Äôm really happy you said yes üíñ</div>
          <h1>Now it‚Äôs official.</h1>
          <p class="sub">
            I don‚Äôt want perfect ‚Äî I want <b>us</b>.  
            Tap a memory to see it full-screen. Swipe left/right like a little story.
          </p>

          <div class="actions">
            <a class="btn btn-primary" href={backLink}>Back</a>
            <a class="btn" href="#timeline">See our story ‚Üì</a>
          </div>
        </div>

        <div class="divider"></div>

        <section class="timeline" id="timeline" aria-label="Timeline story layout">
          <div class="timeline-head">
            <h2>Little moments I love</h2>
            <p class="hint">Swipe ‚Ä¢ Arrow keys ‚Ä¢ ESC closes ‚Ä¢ Space toggles slideshow</p>
          </div>

          <div class="story">
            {memories.map((m, idx) => (
              <div class="event">
                <div class="pin" aria-hidden="true"></div>

                <button
                  class="tile"
                  type="button"
                  data-idx={String(idx)}
                  data-src={m.src}
                  data-type={m.type}
                  data-date={m.date}
                  data-caption={m.caption}
                  aria-label={`Open ${m.date}`}
                >
                  {m.type === "video" ? (
                    <>
                      <img src={videoThumb} alt={m.caption} loading="lazy" />
                      <div class="video-badge">‚ñ∂ video</div>
                    </>
                  ) : (
                    <img src={m.src} alt={m.caption} loading="lazy" />
                  )}

                  <div class="cap">
                    <div class="date">{m.date}</div>
                    <div class="text">{m.caption}</div>
                  </div>
                </button>
              </div>
            ))}
          </div>
        </section>
      </section>
    </main>

    <!-- Lightbox -->
    <div class="lightbox" id="lb" aria-hidden="true">
      <div class="lb-inner" role="dialog" aria-modal="true" aria-label="Viewer">
        <div class="lb-bar">
          <span class="lb-title" id="lbTitle">Memory</span>
          <div class="lb-controls">
            <button class="iconbtn" type="button" id="prevBtn" aria-label="Previous">‚óÄ</button>
            <button class="iconbtn" type="button" id="playBtn" aria-label="Play slideshow">‚ñ∂</button>
            <button class="iconbtn" type="button" id="nextBtn" aria-label="Next">‚ñ∂‚ñ∂</button>
            <button class="iconbtn" type="button" id="closeBtn" aria-label="Close">‚úï</button>
          </div>
        </div>

        <div class="lb-stage" id="lbStage">
          <div class="lb-media" id="lbMedia"></div>

          <div class="lb-caption">
            <div class="date" id="lbDate"></div>
            <div class="text" id="lbText"></div>
          </div>
        </div>

        <div class="lb-hint">
          Mobile: swipe ‚óÄ ‚ñ∂ ‚Ä¢ Desktop: ‚Üê ‚Üí ‚Ä¢ Space slideshow ‚Ä¢ Video: use play controls
        </div>
      </div>
    </div>

    <script>
      // floating hearts
      const heartsHost = document.getElementById("hearts");
      const heartChars = ["‚ù§","‚ô•","‚ô°","üíñ","‚ú®"];
      for (let i = 0; i < 18; i++) {
        const s = document.createElement("span");
        s.textContent = heartChars[i % heartChars.length];
        s.style.setProperty("--x", (Math.random() * 100) + "vw");
        s.style.setProperty("--y", (Math.random() * 100) + "vh");
        s.style.setProperty("--s", (14 + Math.random() * 22) + "px");
        s.style.setProperty("--d", (4.8 + Math.random() * 4.2) + "s");
        heartsHost.appendChild(s);
      }

      // lightbox + slideshow + swipe
      const tiles = Array.from(document.querySelectorAll(".tile"));
      const lb = document.getElementById("lb");
      const lbStage = document.getElementById("lbStage");
      const lbMedia = document.getElementById("lbMedia");

      const lbTitle = document.getElementById("lbTitle");
      const lbDate = document.getElementById("lbDate");
      const lbText = document.getElementById("lbText");

      const prevBtn = document.getElementById("prevBtn");
      const nextBtn = document.getElementById("nextBtn");
      const playBtn = document.getElementById("playBtn");
      const closeBtn = document.getElementById("closeBtn");

      let current = 0;
      let playing = false;
      let timer = null;
      const intervalMs = 2400;

      function isOpen(){ return lb.classList.contains("open"); }

      function setPlaying(on){
        playing = on;
        playBtn.textContent = playing ? "‚è∏" : "‚ñ∂";
        playBtn.setAttribute("aria-label", playing ? "Pause slideshow" : "Play slideshow");
        if (timer) clearInterval(timer);
        timer = null;

        if (playing) {
          timer = setInterval(() => {
            const t = tiles[current];
            if (t?.dataset.type === "video") { setPlaying(false); return; }
            go(1);
          }, intervalMs);
        }
      }

      function clearMedia(){ lbMedia.innerHTML = ""; }

      function stopVideo(){
        const v = lbMedia.querySelector("video");
        if (v) {
          try { v.pause(); } catch {}
          v.removeAttribute("src");
          try { v.load(); } catch {}
        }
      }

      function openLB(idx){
        current = idx;
        lb.classList.add("open");
        lb.setAttribute("aria-hidden", "false");
        document.body.style.overflow = "hidden";
        render();
      }

      function closeLB(){
        lb.classList.remove("open");
        lb.setAttribute("aria-hidden", "true");
        document.body.style.overflow = "";
        setPlaying(false);
        stopVideo();
        clearMedia();
      }

      function render(){
        const t = tiles[current];
        if (!t) return;

        const src = t.dataset.src || "";
        const type = t.dataset.type || "image";
        const date = t.dataset.date || "";
        const caption = t.dataset.caption || "";

        lbTitle.textContent = (type === "video") ? "A little replay üíñ" : "A moment I love";
        lbDate.textContent = date;
        lbText.textContent = caption;

        setPlaying(false);
        stopVideo();
        clearMedia();

        if (type === "video") {
          const wrap = document.createElement("div");
          wrap.style.width = "100%";
          wrap.style.display = "grid";
          wrap.style.placeItems = "center";

          const vid = document.createElement("video");
          vid.controls = true;
          vid.playsInline = true;
          vid.preload = "auto";
          vid.autoplay = true;
          vid.muted = false;
          vid.style.width = "100%";
          vid.style.maxHeight = "76vh";
          vid.style.objectFit = "contain";
          vid.style.background = "rgba(0,0,0,0.22)";

          const status = document.createElement("div");
          status.style.fontFamily = "var(--sans)";
          status.style.fontSize = "0.95rem";
          status.style.color = "rgba(255,255,255,0.78)";
          status.style.padding = "12px 14px";
          status.style.textAlign = "center";
          status.textContent = "Loading your video‚Ä¶";

          // If codec is unsupported (common HEVC), we show a romantic fallback message
          vid.addEventListener("error", () => {
            status.innerHTML =
              "This device can‚Äôt show this video format (but I promise it‚Äôs a cute one).<br/>" +
              "If you want it to work everywhere, re-upload as <b>H.264 MP4</b> (I can guide you). üíó";
          });

          vid.addEventListener("canplay", () => { status.textContent = ""; });

          vid.src = src;
          wrap.appendChild(vid);
          wrap.appendChild(status);
          lbMedia.appendChild(wrap);

          setTimeout(() => {
            const p = vid.play();
            if (p && typeof p.catch === "function") p.catch(() => {});
          }, 120);
        } else {
          const img = document.createElement("img");
          img.src = src;
          img.alt = caption;
          lbMedia.appendChild(img);
        }
      }

      function go(dir){
        current = (current + dir + tiles.length) % tiles.length;
        render();
      }

      // open tile
      tiles.forEach((t, i) => t.addEventListener("click", () => openLB(i)));

      // controls
      prevBtn.addEventListener("click", () => go(-1));
      nextBtn.addEventListener("click", () => go(1));
      playBtn.addEventListener("click", () => setPlaying(!playing));
      closeBtn.addEventListener("click", closeLB);

      // click outside closes
      lb.addEventListener("click", (e) => { if (e.target === lb) closeLB(); });

      // keyboard
      window.addEventListener("keydown", (e) => {
        if (!isOpen()) return;
        if (e.key === "Escape") closeLB();
        if (e.key === "ArrowLeft") go(-1);
        if (e.key === "ArrowRight") go(1);
        if (e.key === " ") { e.preventDefault(); setPlaying(!playing); }
      });

      // swipe
      let x0 = null, y0 = null;
      function onTouchStart(e){
        const t = e.touches && e.touches[0];
        if (!t) return;
        x0 = t.clientX;
        y0 = t.clientY;
      }
      function onTouchMove(e){
        if (!isOpen()) return;
        if (x0 === null || y0 === null) return;
        e.preventDefault();
      }
      function onTouchEnd(e){
        const t = e.changedTouches && e.changedTouches[0];
        if (!t || x0 === null || y0 === null) return;
        const dx = t.clientX - x0;
        const dy = t.clientY - y0;
        if (Math.abs(dx) > 45 && Math.abs(dx) > Math.abs(dy)) {
          if (dx < 0) go(1); else go(-1);
        }
        x0 = null; y0 = null;
      }
      lbStage.addEventListener("touchstart", onTouchStart, { passive: true });
      lbStage.addEventListener("touchmove", onTouchMove, { passive: false });
      lbStage.addEventListener("touchend", onTouchEnd, { passive: true });

      document.addEventListener("visibilitychange", () => {
        if (document.hidden) setPlaying(false);
      });
    </script>
  </body>
</html>
