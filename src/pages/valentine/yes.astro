---
const memories = [
  { src: "/images/3.jpg",   type: "image", caption: "Memory 3",  date: "Together" },
  { src: "/images/4.jpg",   type: "image", caption: "Memory 4",  date: "Fun" },
  { src: "/images/5.jpg",   type: "image", caption: "Memory 5",  date: "Smiles" },
  { src: "/images/6.jpg",   type: "image", caption: "Memory 6",  date: "Laughs" },
  { src: "/images/7.jpg",   type: "image", caption: "Memory 7",  date: "Adventure" },
  { src: "/images/8.jpg",   type: "image", caption: "Memory 8",  date: "Travel" },
  { src: "/images/9.jpg",   type: "image", caption: "Memory 9",  date: "Joy" },
  { src: "/images/10.jpg",  type: "image", caption: "Memory 10", date: "Love" },
  { src: "/images/11.jpg",  type: "image", caption: "Memory 11", date: "Days" },
  { src: "/images/15.jpg",  type: "image", caption: "Memory 15", date: "Special" },
  { src: "/images/16.jpg",  type: "image", caption: "Memory 16", date: "Always" },
  { src: "/images/20.mp4",  type: "video", caption: "Memory 20 (Video)", date: "Replay" },
];

const backLink = "/valentine";
const videoThumb = "/images/16.jpg"; // thumbnail shown in timeline for the video tile
---

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>It‚Äôs a YES üíñ</title>
    <meta name="theme-color" content="#0a0217" />

    <style>
      :root {
        --bg1: #2b0b3f;
        --bg2: #0a0217;
        --bg3: #04010a;
        --text: #fdf7ff;
        --muted: rgba(255, 255, 255, 0.75);
        --card: rgba(16, 5, 32, 0.72);
        --stroke: rgba(255, 255, 255, 0.12);
        --shadow: rgba(8, 2, 18, 0.55);

        --pink1: #ff7ac8;
        --pink2: #f73c72;
        --blue2: #548bff;

        --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono",
          "Courier New", monospace;
        --sans: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
      }

      * { box-sizing: border-box; }
      html, body { height: 100%; }
      body {
        margin: 0;
        color: var(--text);
        font-family: var(--sans);
        overflow-x: hidden;
        background:
          radial-gradient(900px 520px at 50% -10%, rgba(255, 122, 200, 0.22), transparent 55%),
          radial-gradient(800px 540px at 0% 30%, rgba(84, 139, 255, 0.16), transparent 55%),
          radial-gradient(circle at top, var(--bg1) 0%, var(--bg2) 55%, var(--bg3) 100%);
      }

      /* Ambient floating hearts */
      .hearts {
        position: fixed;
        inset: 0;
        pointer-events: none;
        z-index: 1;
        opacity: 0.95;
      }
      .hearts span {
        position: absolute;
        left: var(--x);
        top: var(--y);
        font-size: var(--s);
        color: rgba(255, 122, 200, 0.22);
        animation: drift var(--d) ease-in-out infinite;
        filter: blur(0.2px);
      }
      @keyframes drift {
        0%, 100% { transform: translateY(0) translateX(0) scale(1); opacity: 0.25; }
        50% { transform: translateY(-18px) translateX(10px) scale(1.08); opacity: 0.85; }
      }

      .wrap {
        min-height: 100vh;
        display: grid;
        place-items: center;
        padding: 34px 18px;
        position: relative;
        z-index: 2;
      }

      .card {
        width: min(980px, 100%);
        border-radius: 28px;
        background: linear-gradient(180deg, rgba(255,255,255,0.06), rgba(255,255,255,0.02)), var(--card);
        border: 1px solid var(--stroke);
        box-shadow: 0 30px 90px var(--shadow);
        overflow: hidden;
        backdrop-filter: blur(10px);
        -webkit-backdrop-filter: blur(10px);
      }

      .hero {
        padding: clamp(18px, 3.2vw, 30px);
        text-align: center;
      }

      .tag {
        display: inline-flex;
        align-items: center;
        gap: 10px;
        font-family: var(--mono);
        font-size: 0.86rem;
        padding: 10px 14px;
        border-radius: 999px;
        background: rgba(255,255,255,0.08);
        border: 1px solid rgba(255,255,255,0.12);
        color: rgba(255,255,255,0.82);
        margin-bottom: 14px;
      }
      .tag .dot {
        width: 8px; height: 8px; border-radius: 50%;
        background: linear-gradient(135deg, var(--pink1), var(--blue2));
        box-shadow: 0 0 12px rgba(255,122,200,0.45);
      }

      h1 {
        margin: 0 0 8px;
        font-size: clamp(2rem, 3.8vw, 2.8rem);
        line-height: 1.12;
        letter-spacing: -0.02em;
        font-weight: 900;
      }
      .sub {
        margin: 0 auto 16px;
        max-width: 64ch;
        color: var(--muted);
        line-height: 1.65;
      }

      .actions {
        display: flex;
        gap: 12px;
        justify-content: center;
        flex-wrap: wrap;
        margin-top: 10px;
      }
      .btn {
        text-decoration: none;
        padding: 12px 18px;
        border-radius: 999px;
        font-weight: 900;
        border: 1px solid rgba(255,255,255,0.16);
        transition: transform 0.18s ease, box-shadow 0.18s ease, filter 0.18s ease;
        user-select: none;
        display: inline-flex;
        align-items: center;
        gap: 10px;
        cursor: pointer;
        background: rgba(255,255,255,0.06);
        color: rgba(255,255,255,0.92);
      }
      .btn:hover { transform: translateY(-2px); box-shadow: 0 16px 30px rgba(247,146,255,0.16); }
      .btn:active { transform: translateY(0px) scale(0.99); }

      .btn-primary {
        background: linear-gradient(135deg, var(--pink1), var(--pink2));
        color: #16010f;
        border-color: rgba(255,122,200,0.35);
      }

      .divider { height: 1px; background: rgba(255,255,255,0.08); }

      /* Timeline */
      .timeline { padding: clamp(16px, 3vw, 26px); }
      .timeline-head {
        display: flex;
        align-items: baseline;
        justify-content: space-between;
        gap: 12px;
        margin-bottom: 14px;
        flex-wrap: wrap;
      }
      .timeline h2 { margin: 0; font-size: 1.08rem; letter-spacing: 0.02em; }
      .hint { margin: 0; color: rgba(255,255,255,0.62); font-size: 0.95rem; font-family: var(--mono); }

      .story {
        position: relative;
        padding-left: 22px;
        display: grid;
        gap: 14px;
      }
      .story::before {
        content: "";
        position: absolute;
        left: 10px;
        top: 4px;
        bottom: 4px;
        width: 2px;
        background: linear-gradient(180deg, rgba(255,122,200,0.6), rgba(84,139,255,0.2));
        opacity: 0.55;
      }

      .event { position: relative; }
      .pin {
        position: absolute;
        left: -2px;
        top: 18px;
        width: 18px; height: 18px;
        border-radius: 50%;
        background: linear-gradient(135deg, rgba(255,122,200,0.95), rgba(84,139,255,0.85));
        box-shadow: 0 0 0 4px rgba(255,255,255,0.06), 0 16px 30px rgba(255,122,200,0.18);
      }

      .tile {
        position: relative;
        border-radius: 20px;
        overflow: hidden;
        border: 1px solid rgba(255,255,255,0.12);
        background: rgba(0,0,0,0.16);
        cursor: pointer;
        aspect-ratio: 16 / 9;
        transform: translateY(0);
        transition: transform 0.25s ease, box-shadow 0.25s ease;
        padding: 0;
        width: 100%;
        text-align: left;
      }
      .tile:hover {
        transform: translateY(-2px);
        box-shadow: 0 18px 50px rgba(0,0,0,0.25);
      }

      .tile img {
        width: 100%;
        height: 100%;
        display: block;
        object-fit: cover;
        transform: scale(1.02);
        transition: transform 0.35s ease, filter 0.35s ease;
        filter: saturate(1.05);
      }
      .tile:hover img { transform: scale(1.08); filter: saturate(1.18); }

      .video-badge {
        position: absolute;
        top: 12px;
        right: 12px;
        font-family: var(--mono);
        font-size: 0.82rem;
        padding: 8px 10px;
        border-radius: 999px;
        background: rgba(0,0,0,0.45);
        border: 1px solid rgba(255,255,255,0.16);
        color: rgba(255,255,255,0.9);
        backdrop-filter: blur(8px);
      }

      /* Caption overlay on tiles */
      .cap {
        position: absolute;
        inset: auto 0 0 0;
        padding: 12px 12px 12px;
        background: linear-gradient(180deg, transparent, rgba(0,0,0,0.65));
        color: rgba(255,255,255,0.92);
      }
      .cap .date { font-family: var(--mono); font-size: 0.82rem; opacity: 0.85; }
      .cap .text { margin-top: 4px; font-size: 0.98rem; line-height: 1.35; font-weight: 800; }

      /* Lightbox */
      .lightbox {
        position: fixed;
        inset: 0;
        display: none;
        place-items: center;
        background: rgba(0,0,0,0.72);
        z-index: 999;
        padding: 18px;
      }
      .lightbox.open { display: grid; }

      /* Cinematic transitions */
      .lb-inner {
        width: min(1020px, 100%);
        background: rgba(16, 5, 32, 0.78);
        border: 1px solid rgba(255,255,255,0.14);
        border-radius: 22px;
        overflow: hidden;
        box-shadow: 0 30px 90px rgba(0,0,0,0.55);
        transform: scale(0.985);
        opacity: 0;
        animation: cinIn 240ms ease forwards;
      }
      @keyframes cinIn { to { transform: scale(1); opacity: 1; } }

      .lb-bar {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 10px;
        padding: 12px 14px;
        background: rgba(255,255,255,0.04);
        border-bottom: 1px solid rgba(255,255,255,0.08);
        font-family: var(--mono);
        color: rgba(255,255,255,0.72);
        font-size: 0.85rem;
      }
      .lb-controls { display: inline-flex; gap: 8px; align-items: center; }
      .iconbtn {
        background: rgba(255,255,255,0.06);
        color: rgba(255,255,255,0.88);
        border: 1px solid rgba(255,255,255,0.14);
        border-radius: 999px;
        padding: 8px 12px;
        cursor: pointer;
        user-select: none;
        transition: transform 0.15s ease, filter 0.15s ease;
      }
      .iconbtn:hover { transform: translateY(-1px); filter: brightness(1.08); }
      .iconbtn:active { transform: translateY(0px) scale(0.99); }

      .lb-stage {
        position: relative;
        background: rgba(0,0,0,0.22);
        display: grid;
        place-items: center;
        min-height: 45vh;
      }

      .lb-img, .lb-video {
        width: 100%;
        height: auto;
        max-height: 76vh;
        object-fit: contain;
        display: none;
        opacity: 0;
        transform: scale(0.995);
        transition: opacity 220ms ease, transform 220ms ease;
        background: rgba(0,0,0,0.22);
      }
      .show { display: block; }
      .fadeIn { opacity: 1; transform: scale(1); }

      /* Caption overlay in lightbox */
      .lb-caption {
        position: absolute;
        left: 0;
        right: 0;
        bottom: 0;
        padding: 14px 14px 16px;
        background: linear-gradient(180deg, transparent, rgba(0,0,0,0.78));
        color: rgba(255,255,255,0.92);
        text-align: left;
        pointer-events: none; /* IMPORTANT: don't block video controls */
      }
      .lb-caption .date { font-family: var(--mono); font-size: 0.82rem; opacity: 0.86; }
      .lb-caption .text { margin-top: 4px; font-size: 1.02rem; line-height: 1.35; font-weight: 900; }

      .lb-hint {
        padding: 10px 14px 14px;
        color: rgba(255,255,255,0.62);
        font-family: var(--mono);
        font-size: 0.82rem;
        border-top: 1px solid rgba(255,255,255,0.08);
        background: rgba(255,255,255,0.02);
      }

      @media (prefers-reduced-motion: reduce) {
        * { animation: none !important; transition: none !important; }
      }
    </style>
  </head>

  <body>
    <div class="hearts" aria-hidden="true" id="hearts"></div>

    <main class="wrap">
      <section class="card" aria-label="Yes page with timeline gallery">
        <div class="hero">
          <div class="tag"><span class="dot"></span> ‚úÖ git merge origin/love ‚Äî success</div>
          <h1>It‚Äôs a YES üíñ</h1>
          <p class="sub">
            Tap a memory to view it full-screen. On mobile you can swipe left/right.
            Press ‚ñ∂ for slideshow (it pauses on video unless you hit play).
          </p>

          <div class="actions">
            <a class="btn btn-primary" href={backLink}>Back to invite</a>
            <a class="btn" href="#timeline">Jump to timeline ‚Üì</a>
          </div>
        </div>

        <div class="divider"></div>

        <section class="timeline" id="timeline" aria-label="Timeline story layout">
          <div class="timeline-head">
            <h2>Our Story Timeline</h2>
            <p class="hint">Swipe ‚Ä¢ Arrow keys ‚Ä¢ ESC closes ‚Ä¢ Space toggles slideshow</p>
          </div>

          <div class="story">
            {memories.map((m, idx) => (
              <div class="event">
                <div class="pin" aria-hidden="true"></div>

                <button
                  class="tile"
                  type="button"
                  data-idx={String(idx)}
                  data-src={m.src}
                  data-type={m.type}
                  data-date={m.date}
                  data-caption={m.caption}
                  aria-label={`Open ${m.date}`}
                >
                  {m.type === "video" ? (
                    <>
                      {/* IMPORTANT: don't render a <video> here. Use thumbnail only. */}
                      <img src={videoThumb} alt={m.caption} loading="lazy" />
                      <div class="video-badge">‚ñ∂ video</div>
                    </>
                  ) : (
                    <img src={m.src} alt={m.caption} loading="lazy" />
                  )}

                  <div class="cap">
                    <div class="date">{m.date}</div>
                    <div class="text">{m.caption}</div>
                  </div>
                </button>
              </div>
            ))}
          </div>
        </section>
      </section>
    </main>

    <!-- Lightbox -->
    <div class="lightbox" id="lb" aria-hidden="true">
      <div class="lb-inner" role="dialog" aria-modal="true" aria-label="Viewer">
        <div class="lb-bar">
          <span id="lbTitle">memory</span>
          <div class="lb-controls">
            <button class="iconbtn" type="button" id="prevBtn" aria-label="Previous">‚óÄ</button>
            <button class="iconbtn" type="button" id="playBtn" aria-label="Play slideshow">‚ñ∂</button>
            <button class="iconbtn" type="button" id="nextBtn" aria-label="Next">‚ñ∂‚ñ∂</button>
            <button class="iconbtn" type="button" id="closeBtn" aria-label="Close">‚úï</button>
          </div>
        </div>

        <div class="lb-stage" id="lbStage">
          <img class="lb-img" id="lbImg" alt="" />
          <video class="lb-video" id="lbVideo" controls playsinline></video>

          <div class="lb-caption">
            <div class="date" id="lbDate"></div>
            <div class="text" id="lbText"></div>
          </div>
        </div>

        <div class="lb-hint">
          Mobile: swipe ‚óÄ ‚ñ∂ ‚Ä¢ Desktop: ‚Üê ‚Üí ‚Ä¢ Space slideshow ‚Ä¢ Video: use controls
        </div>
      </div>
    </div>

    <script>
      // Floating hearts particles
      const heartsHost = document.getElementById("hearts");
      const heartChars = ["‚ù§", "‚ô•", "‚ô°", "üíñ", "‚ú®"];
      const heartCount = 18;
      for (let i = 0; i < heartCount; i++) {
        const s = document.createElement("span");
        s.textContent = heartChars[i % heartChars.length];
        s.style.setProperty("--x", (Math.random() * 100) + "vw");
        s.style.setProperty("--y", (Math.random() * 100) + "vh");
        s.style.setProperty("--s", (14 + Math.random() * 22) + "px");
        s.style.setProperty("--d", (4.8 + Math.random() * 4.2) + "s");
        heartsHost.appendChild(s);
      }

      // Lightbox + slideshow + swipe + video support
      const tiles = Array.from(document.querySelectorAll(".tile"));
      const lb = document.getElementById("lb");
      const lbStage = document.getElementById("lbStage");

      const lbImg = document.getElementById("lbImg");
      const lbVideo = document.getElementById("lbVideo");

      const lbTitle = document.getElementById("lbTitle");
      const lbDate = document.getElementById("lbDate");
      const lbText = document.getElementById("lbText");

      const prevBtn = document.getElementById("prevBtn");
      const nextBtn = document.getElementById("nextBtn");
      const playBtn = document.getElementById("playBtn");
      const closeBtn = document.getElementById("closeBtn");

      let current = 0;
      let playing = false;
      let timer = null;
      const intervalMs = 2400;

      function isOpen() {
        return lb.classList.contains("open");
      }

      function setPlaying(on) {
        playing = on;
        playBtn.textContent = playing ? "‚è∏" : "‚ñ∂";
        playBtn.setAttribute("aria-label", playing ? "Pause slideshow" : "Play slideshow");

        if (timer) clearInterval(timer);
        timer = null;

        if (playing) {
          timer = setInterval(() => {
            const t = tiles[current];
            if (t?.dataset.type === "video") {
              setPlaying(false);
              return;
            }
            go(1);
          }, intervalMs);
        }
      }

      function openLB(idx) {
        current = idx;
        lb.classList.add("open");
        lb.setAttribute("aria-hidden", "false");
        document.body.style.overflow = "hidden";
        render();
      }

      function closeLB() {
        lb.classList.remove("open");
        lb.setAttribute("aria-hidden", "true");
        document.body.style.overflow = "";
        setPlaying(false);
        stopVideo();
        clearMedia();
      }

      function clearMedia() {
        lbImg.classList.remove("show", "fadeIn");
        lbVideo.classList.remove("show", "fadeIn");
        lbImg.src = "";
        lbImg.alt = "";
        lbVideo.removeAttribute("src");
        lbVideo.load();
      }

      function stopVideo() {
        try { lbVideo.pause(); } catch {}
      }

      function render() {
        const t = tiles[current];
        if (!t) return;

        const src = t.dataset.src || "";
        const type = t.dataset.type || "image";
        const date = t.dataset.date || "";
        const caption = t.dataset.caption || "";
        const title = (src.split("/").pop() || "memory");

        lbTitle.textContent = title;
        lbDate.textContent = date;
        lbText.textContent = caption;

        stopVideo();
        lbImg.classList.remove("fadeIn");
        lbVideo.classList.remove("fadeIn");

        if (type === "video") {
          // Show video, hide image
          lbImg.classList.remove("show");
          lbVideo.classList.add("show");

          // Hard reset + reload (prevents stuck state)
          lbVideo.pause();
          lbVideo.removeAttribute("src");
          lbVideo.load();

          lbVideo.src = src;
          lbVideo.muted = false;      // viewer open is a user gesture
          lbVideo.playsInline = true;
          lbVideo.preload = "auto";
          lbVideo.controls = true;

          lbVideo.load();
          requestAnimationFrame(() => lbVideo.classList.add("fadeIn"));

          // Try autoplay; if blocked, controls still work
          setTimeout(() => {
            const p = lbVideo.play();
            if (p && typeof p.catch === "function") p.catch(() => {});
          }, 150);

          if (playing) setPlaying(false);
        } else {
          // Show image, hide video
          lbVideo.classList.remove("show");
          lbImg.classList.add("show");

          const img = new Image();
          img.onload = () => {
            lbImg.src = src;
            lbImg.alt = caption;
            requestAnimationFrame(() => lbImg.classList.add("fadeIn"));
          };
          img.src = src;
        }
      }

      function go(dir) {
        current = (current + dir + tiles.length) % tiles.length;
        render();
      }

      tiles.forEach((t, i) => t.addEventListener("click", () => openLB(i)));

      prevBtn.addEventListener("click", () => go(-1));
      nextBtn.addEventListener("click", () => go(1));
      playBtn.addEventListener("click", () => setPlaying(!playing));
      closeBtn.addEventListener("click", closeLB);

      lb.addEventListener("click", (e) => {
        if (e.target === lb) closeLB();
      });

      window.addEventListener("keydown", (e) => {
        if (!isOpen()) return;
        if (e.key === "Escape") closeLB();
        if (e.key === "ArrowLeft") go(-1);
        if (e.key === "ArrowRight") go(1);
        if (e.key === " ") { e.preventDefault(); setPlaying(!playing); }
      });

      // Swipe gestures (mobile)
      let x0 = null, y0 = null;

      function onTouchStart(e) {
        const t = e.touches && e.touches[0];
        if (!t) return;
        x0 = t.clientX;
        y0 = t.clientY;
      }

      function onTouchMove(e) {
        if (!isOpen()) return;
        if (x0 === null || y0 === null) return;
        e.preventDefault();
      }

      function onTouchEnd(e) {
        const t = e.changedTouches && e.changedTouches[0];
        if (!t || x0 === null || y0 === null) return;

        const dx = t.clientX - x0;
        const dy = t.clientY - y0;

        if (Math.abs(dx) > 45 && Math.abs(dx) > Math.abs(dy)) {
          if (dx < 0) go(1);
          else go(-1);
        }
        x0 = null; y0 = null;
      }

      lbStage.addEventListener("touchstart", onTouchStart, { passive: true });
      lbStage.addEventListener("touchmove", onTouchMove, { passive: false });
      lbStage.addEventListener("touchend", onTouchEnd, { passive: true });

      document.addEventListener("visibilitychange", () => {
        if (document.hidden) setPlaying(false);
      });

      lbVideo.addEventListener("play", () => {
        if (playing) setPlaying(false);
      });
    </script>
  </body>
</html>
